{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Abdul Rehman\\\\Desktop\\\\Project\\\\First_And_Second_Module_v1.0\\\\frontend\\\\src\\\\AdminComponents\\\\messages\\\\GuadianMessage.js\",\n  _s = $RefreshSig$();\nimport React, { useState } from \"react\";\nimport SendToForm from \"../../components/messages/SendToForm\";\nimport axios from \"../../store/axios\";\nimport { errorAlert, successAlert } from \"../../utils\";\nimport { useSelector } from \"react-redux\";\nimport { selectUser } from \"../../store/slices/userSlice\";\nimport { debounce } from \"throttle-debounce\";\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nfunction GuadianMessage() {\n  _s();\n  const [message, setmessage] = useState(\"\");\n  const [recipientsOptions, setrecipientsOptions] = useState([]);\n  const [recipient, setrecipient] = useState(\"\");\n  const sender = useSelector(selectUser);\n  const [studentsList, setstudentsList] = useState([]);\n  const [search, setsearch] = useState(\"\");\n  const [sendto, setsendto] = useState(\"Guadian\");\n  const autocompleteSearch = () => {\n    if (search) {\n      axios.get(`/students/search/${search}`).then(res => {\n        if (res.data.error) {\n          errorAlert(res.data.error);\n          return 0;\n        }\n        setstudentsList(res.data.users.map(user => {\n          return {\n            _id: user._id,\n            userID: user.userID,\n            name: user.name,\n            surname: user.surname\n          };\n        }));\n      });\n    }\n  };\n  const autocompleteSearchDebounced = debounce(500, autocompleteSearch);\n  const onSend = e => {\n    e.preventDefault();\n    if (message && recipient) {\n      let selected = recipientsOptions.find(i => i.id === recipient);\n      if (!(selected !== null && selected !== void 0 && selected.mobile)) {\n        return errorAlert(\"Parent does not have phone number\");\n      }\n      axios.post(`/chats`, {\n        message,\n        userID: recipient,\n        telephone: selected === null || selected === void 0 ? void 0 : selected.mobile,\n        sender: sender === null || sender === void 0 ? void 0 : sender.id\n      }).then(res => {\n        if (res.data.error) {\n          errorAlert(res.data.error);\n          return 0;\n        }\n        successAlert(\"message send\");\n        setmessage(\"\");\n      });\n    }\n  };\n  const handleSearchbyName = e => {\n    e.preventDefault();\n    autocompleteSearch();\n  };\n  const handleChange = e => {\n    setsearch(e.target.value);\n    autocompleteSearchDebounced(e.target.value);\n  };\n  const handleSearchParents = id => {\n    axios.get(`/students/parents/${id}`).then(res => {\n      console.log(res.data);\n      if (res.data.error) {\n        errorAlert(res.data.error);\n        return 0;\n      }\n      setrecipientsOptions(res.data.docs);\n    });\n  };\n  const searchOptions = () => {\n    return recipientsOptions.map(option => /*#__PURE__*/_jsxDEV(\"option\", {\n      value: option.id,\n      children: [option.name, \" \", option.surname, \" \", option.relationship, \" \"]\n    }, option.id, true, {\n      fileName: _jsxFileName,\n      lineNumber: 90,\n      columnNumber: 7\n    }, this));\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"mb-5 content__container row\",\n      children: /*#__PURE__*/_jsxDEV(\"form\", {\n        onSubmit: handleSearchbyName,\n        className: \"mb-5 col-12 \",\n        children: [/*#__PURE__*/_jsxDEV(\"label\", {\n          className: \"form-label\",\n          children: \"Search for Student by Name or ID\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 100,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"d-flex flex-row\",\n          children: [/*#__PURE__*/_jsxDEV(\"input\", {\n            value: search,\n            onChange: handleChange,\n            className: \"form-control\",\n            type: \"text\",\n            placeholder: \"Type here...\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 102,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"btn blue__btn\",\n            children: \"Search\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 109,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 101,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"ul\", {\n          className: \"students__container\",\n          children: studentsList.length > 0 ? /*#__PURE__*/_jsxDEV(_Fragment, {\n            children: studentsList.map(option => /*#__PURE__*/_jsxDEV(\"li\", {\n              onClick: () => handleSearchParents(option._id),\n              className: \"option\",\n              children: [option.name, \" \", option.surname, \" \", option.userID, \" \"]\n            }, option._id, true, {\n              fileName: _jsxFileName,\n              lineNumber: 115,\n              columnNumber: 19\n            }, this))\n          }, void 0, false) : /*#__PURE__*/_jsxDEV(\"li\", {\n            children: \"No results found\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 125,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 111,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 99,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 98,\n      columnNumber: 7\n    }, this), recipientsOptions.length > 0 && /*#__PURE__*/_jsxDEV(SendToForm, {\n      message: message,\n      setmessage: setmessage,\n      onSend: onSend,\n      searchOptions: searchOptions,\n      recipient: recipient,\n      setrecipient: setrecipient,\n      sender: sender === null || sender === void 0 ? void 0 : sender.id,\n      sendto: sendto\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 131,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 97,\n    columnNumber: 5\n  }, this);\n}\n_s(GuadianMessage, \"VEjLBcgScguTlTE2DGMkOrRh0m8=\", false, function () {\n  return [useSelector];\n});\n_c = GuadianMessage;\nexport default GuadianMessage;\nvar _c;\n$RefreshReg$(_c, \"GuadianMessage\");","map":{"version":3,"names":["React","useState","SendToForm","axios","errorAlert","successAlert","useSelector","selectUser","debounce","jsxDEV","_jsxDEV","Fragment","_Fragment","GuadianMessage","_s","message","setmessage","recipientsOptions","setrecipientsOptions","recipient","setrecipient","sender","studentsList","setstudentsList","search","setsearch","sendto","setsendto","autocompleteSearch","get","then","res","data","error","users","map","user","_id","userID","name","surname","autocompleteSearchDebounced","onSend","e","preventDefault","selected","find","i","id","mobile","post","telephone","handleSearchbyName","handleChange","target","value","handleSearchParents","console","log","docs","searchOptions","option","children","relationship","fileName","_jsxFileName","lineNumber","columnNumber","className","onSubmit","onChange","type","placeholder","length","onClick","_c","$RefreshReg$"],"sources":["C:/Users/Abdul Rehman/Desktop/Project/First_And_Second_Module_v1.0/frontend/src/AdminComponents/messages/GuadianMessage.js"],"sourcesContent":["import React, { useState } from \"react\";\nimport SendToForm from \"../../components/messages/SendToForm\";\nimport axios from \"../../store/axios\";\nimport { errorAlert, successAlert } from \"../../utils\";\nimport { useSelector } from \"react-redux\";\nimport { selectUser } from \"../../store/slices/userSlice\";\nimport { debounce } from \"throttle-debounce\";\n\nfunction GuadianMessage() {\n  const [message, setmessage] = useState(\"\");\n  const [recipientsOptions, setrecipientsOptions] = useState([]);\n  const [recipient, setrecipient] = useState(\"\");\n  const sender = useSelector(selectUser);\n  const [studentsList, setstudentsList] = useState([]);\n  const [search, setsearch] = useState(\"\");\n  const [sendto, setsendto] = useState(\"Guadian\");\n\n  const autocompleteSearch = () => {\n    if (search) {\n      axios.get(`/students/search/${search}`).then((res) => {\n        if (res.data.error) {\n          errorAlert(res.data.error);\n          return 0;\n        }\n        setstudentsList(\n          res.data.users.map((user) => {\n            return {\n              _id: user._id,\n              userID: user.userID,\n              name: user.name,\n              surname: user.surname,\n            };\n          })\n        );\n      });\n    }\n  };\n\n  const autocompleteSearchDebounced = debounce(500, autocompleteSearch);\n\n  const onSend = (e) => {\n    e.preventDefault();\n    if (message && recipient) {\n      let selected = recipientsOptions.find((i) => i.id === recipient);\n      if (!selected?.mobile) {\n        return errorAlert(\"Parent does not have phone number\");\n      }\n\n      axios\n        .post(`/chats`, {\n          message,\n          userID: recipient,\n          telephone: selected?.mobile,\n          sender: sender?.id,\n        })\n        .then((res) => {\n          if (res.data.error) {\n            errorAlert(res.data.error);\n            return 0;\n          }\n          successAlert(\"message send\");\n          setmessage(\"\");\n        });\n    }\n  };\n\n  const handleSearchbyName = (e) => {\n    e.preventDefault();\n    autocompleteSearch();\n  };\n\n  const handleChange = (e) => {\n    setsearch(e.target.value);\n    autocompleteSearchDebounced(e.target.value);\n  };\n\n  const handleSearchParents = (id) => {\n    axios.get(`/students/parents/${id}`).then((res) => {\n      console.log(res.data);\n      if (res.data.error) {\n        errorAlert(res.data.error);\n        return 0;\n      }\n      setrecipientsOptions(res.data.docs);\n    });\n  };\n\n  const searchOptions = () => {\n    return recipientsOptions.map((option) => (\n      <option key={option.id} value={option.id}>\n        {option.name} {option.surname} {option.relationship}{\" \"}\n      </option>\n    ));\n  };\n\n  return (\n    <div>\n      <div className=\"mb-5 content__container row\">\n        <form onSubmit={handleSearchbyName} className=\"mb-5 col-12 \">\n          <label className=\"form-label\">Search for Student by Name or ID</label>\n          <div className=\"d-flex flex-row\">\n            <input\n              value={search}\n              onChange={handleChange}\n              className=\"form-control\"\n              type=\"text\"\n              placeholder=\"Type here...\"\n            />\n            <button className=\"btn blue__btn\">Search</button>\n          </div>\n          <ul className=\"students__container\">\n            {studentsList.length > 0 ? (\n              <>\n                {studentsList.map((option) => (\n                  <li\n                    onClick={() => handleSearchParents(option._id)}\n                    key={option._id}\n                    className=\"option\"\n                  >\n                    {option.name} {option.surname} {option.userID}{\" \"}\n                  </li>\n                ))}\n              </>\n            ) : (\n              <li>No results found</li>\n            )}\n          </ul>\n        </form>\n      </div>\n      {recipientsOptions.length > 0 && (\n        <SendToForm\n          message={message}\n          setmessage={setmessage}\n          onSend={onSend}\n          searchOptions={searchOptions}\n          recipient={recipient}\n          setrecipient={setrecipient}\n          sender={sender?.id}\n          sendto={sendto}\n        />\n      )}\n    </div>\n  );\n}\n\nexport default GuadianMessage;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}